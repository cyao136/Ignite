<% provide(:title, @project.name + " Gallery") %>
<div class="container">
  <%= render :partial => 'projects/header' %>

  <%= button_to 'Upload', {:controller => "projects", :action => "media_upload"}, params:{ :id => project_id } , :method=>:get  %>
  <% @pictures.each do |pic| %>
  	<a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title="" data-caption="" data-image=<%= pic.asset.url %> data-target="#gallery-modal">
  		<%= image_tag pic.asset.url(:thumb) %>
  	</a>
  <% end %>
  <% @videos.each do |vid| %>
  	<a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title="" data-caption="" data-video= <%= vid.asset.url %> data-target="#gallery-modal">
  		<%= image_tag vid.asset.url(:thumb) %>
  	</a>
  <% end %>
</div>


<div class="modal fade" id="gallery-modal" tabindex="-1" role="dialog" aria-labelledby="galleryModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="gallery-modal-title"></h4>
            </div>
            <div class="modal-body">
                <img id="gallery-modal-image" class="img-responsive" src="" hidden=true>
                <video id="gallery-modal-video" src="" type="video/mp4" hidden=true controls autoplay>
            </div>
            <div class="modal-footer">

                <div class="col-md-2">
                    <button type="button" class="btn btn-primary" id="show-previous-image">Previous</button>
                </div>

                <div class="col-md-8 text-justify" id="gallery-modal-caption">
                    This text will be overwritten by jQuery
                </div>

                <div class="col-md-2">
                    <button type="button" id="show-next-image" class="btn btn-default">Next</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
  var disableButtons, loadGallery;
  disableButtons = function(counter_max, counter_current) {
    $('#show-previous-image, #show-next-image').show();
    if (counter_max === counter_current) {
      $('#show-next-image').hide();
    } else if (counter_current === 1) {
      $('#show-previous-image').hide();
    }
  };

  /**
  #
   * @param setIDs        Sets IDs when DOM is loaded. If using a PHP counter, set to false.
   * @param setClickAttr  Sets the attribute for the click handler.
   */
  loadGallery = function(setIDs, setClickAttr) {
    var counter, current_image, selector, updateGallery;
    current_image = void 0;
    selector = void 0;
    counter = 0;
    updateGallery = function(selector) {
      var $sel;
      $sel = selector;
      current_image = $sel.data('image-id');
      $('#gallery-modal-caption').text($sel.data('caption'));
      $('#gallery-modal-title').text($sel.data('title'));
      if ($sel.data('image') != null) {
        $('#gallery-modal-image').attr('src', $sel.data('image'));
        $('#gallery-modal-image').attr('hidden', false);
        $('#gallery-modal-video').attr('hidden', true);
      }
      if ($sel.data('video') != null) {
        $('#gallery-modal-video').attr('src', $sel.data('video'));
        $('#gallery-modal-image').attr('hidden', true);
        $('#gallery-modal-video').attr('hidden', false);
      }
      disableButtons(counter, $sel.data('image-id'));
    };
    $('#show-next-image, #show-previous-image').click(function() {
      if ($(this).attr('id') === 'show-previous-image') {
        current_image--;
      } else {
        current_image++;
      }
      selector = $('[data-image-id="' + current_image + '"]');
      updateGallery(selector);
    });
    if (setIDs === true) {
      $('[data-image-id]').each(function() {
        counter++;
        $(this).attr('data-image-id', counter);
      });
    }
    $(setClickAttr).on('click', function() {
      updateGallery($(this));
    });
  };
  loadGallery(true, 'a.thumbnail');
});

// ---
// generated by coffee-script 1.9.2
</script>